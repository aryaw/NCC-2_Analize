# Analisis Deskriptif Dataset Botnet NCC-2

## 1. Karakteristik Data
Dataset **NCC-2 (Network Common Characterization Dataset)** merupakan dataset trafik jaringan yang digunakan untuk penelitian dalam bidang **Network Intrusion Detection System (NIDS)**, khususnya untuk **deteksi botnet, malware, dan serangan DDoS**.

**Ciri-ciri utama:**
- **Jumlah data:** ¬±65 juta aliran (flows) jaringan
- **Sumber data:** dikumpulkan dari jaringan nyata dan simulasi laboratorium  (CTU & ITS)
- **Tujuan:** Klasifikasi antara *benign (normal)* dan *malicious (botnet)* trafik
- **Label kelas:** 'Benign' dan 'Botnet' (misalnya Mirai, Bashlite, Torii, dll.)

---

## 2. Sifat Data
**Jenis dan sifat data NCC-2:**
- **Sifat:** Sekunder (dikumpulkan oleh pihak ketiga untuk riset publik)
- **Jenis data:** Kuantitatif (numerik) dan Kategorikal (protokol, label)
- **Tipe pengukuran:**
  - **Nominal:** 'Protocol', 'Label'
  - **Rasio/Interval:** 'Flow Duration', 'Pkt Len Mean', 'Tot Fwd Pkts'
- **Domain:** *Network Security / Intrusion Detection / Botnet Detection*
- **Keseimbangan data:** Tidak seimbang (*imbalanced*), benign (normalflow) jauh lebih banyak dari botnet

---

## 3. Bentuk Data
**Struktur data NCC-2:**
- **Format:** '.csv' atau '.arff' (tabular)
- **Baris:** representasi satu *flow* jaringan (satu sesi komunikasi)
- **Kolom:** atribut statistik dari aliran jaringan
- **Ukuran file:** dapat mencapai >10 GB tergantung subset
- **Sumber ekstraksi:** hasil *feature extraction* dari file PCAP menggunakan CICFlowMeter

---

## 4. Kesimpulan
> Dataset **Botnet NCC-2** merupakan dataset sekunder berbentuk tabular berisi rekaman aliran trafik jaringan. Data bersifat kuantitatif dengan sebagian besar fitur numerik dan label kategorikal. Analisis deskriptif menunjukkan distribusi tidak seimbang antara trafik normal dan botnet. Dataset ini sangat relevan untuk penelitian sistem deteksi intrusi berbasis machine learning.

---

## Workflow Stage

| üî¢ **Langkah** | üß© **Blok Kode / Bagian**                       | üßæ **Deskripsi Proses (Penjelasan Lengkap)**                                                                                                                                                                                                                                                                                                                                                                                              |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| -------------- | ----------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ---------------------------------------------------------------------------------------------------- | --------- | ---- | ------ | ------------ | ----------- | ---- | ---- | --- | --- | ---- | ---- | --- | --- | ---- | ---- | --- | --- | -------------------------------------------------------------------------------------------- |
| **1**          | **Import Library**                              | Mengimpor semua library yang dibutuhkan, termasuk: <br>‚Ä¢ `pandas`, `numpy`, `duckdb` untuk data processing <br>‚Ä¢ `scikit-learn` untuk machine learning (StackingClassifier, scaling, dll) <br>‚Ä¢ `plotly` dan `networkx` untuk visualisasi jaringan <br>‚Ä¢ `psutil` untuk monitoring RAM                                                                                                                                                    |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **2**          | **Konfigurasi Awal & Environment Variable**     | - Menentukan **parameter global**, seperti:<br>  `RANDOM_STATE = 42` (agar hasil konsisten)<br>  `MAX_ROWS_FOR_STACKING = 8 juta` (batas data maksimum untuk model stacking).<br>- Menetapkan variabel lingkungan (`OMP_NUM_THREADS`, `MKL_NUM_THREADS`, dsb) agar model tidak memakai banyak thread dan stabil di CPU-only environment.                                                                                                  |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **3**          | **Inisialisasi File Output & Lokasi Dataset**   | - Mendapatkan direktori output untuk menyimpan hasil (melalui fungsi dari `libInternal`).<br>- Menetapkan lokasi dataset: `NCC2AllSensors_clean.csv`.                                                                                                                                                                                                                                                                                     |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **4**          | **Membuat Logger RAM (`log_ram`)**              | Fungsi ini mencatat pemakaian memori (RAM & Virtual Memory) pada tiap tahapan penting ke file `memory_trace_<timestamp>.csv`.<br>‚û°Ô∏è Berguna untuk mendeteksi kebocoran atau lonjakan memori saat training atau visualisasi.                                                                                                                                                                                                               |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **5**          | **Membaca Dataset via DuckDB**                  | - Menggunakan query SQL `read_csv_auto` agar membaca CSV besar dengan efisien.<br>- Mengambil kolom penting: `SrcAddr`, `DstAddr`, `Proto`, `Dur`, `TotBytes`, `TotPkts`, dll.<br>- Memastikan kolom `Label` (label klasifikasi) tersedia.                                                                                                                                                                                                |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **6**          | **Optimisasi DataFrame & Label Biner**          | - Menjalankan `optimize_dataframe()` untuk mengubah tipe kolom agar hemat memori (misalnya float64 ‚Üí float32).<br>- `fast_label_to_binary()` mengubah label teks menjadi label biner (0 = normal, 1 = malicious).                                                                                                                                                                                                                         |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **7**          | **Membersihkan & Encoding Data**                | - Drop baris dengan nilai NaN pada kolom utama.<br>- Konversi kolom `Dir` (arah koneksi) menjadi numerik (`->`=1, `<-`=-1, `<->`=0).<br>- Encode `Proto` dan `State` menjadi angka menggunakan `LabelEncoder()`.                                                                                                                                                                                                                          |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **8**          | **Feature Engineering (Rekayasa Fitur)**        | Membuat fitur tambahan yang menggambarkan karakteristik trafik jaringan, misalnya:<br>‚Ä¢ `ByteRatio = TotBytes / TotPkts`<br>‚Ä¢ `DurationRate = TotPkts / Dur`<br>‚Ä¢ `FlowIntensity = SrcBytes / TotBytes`<br>‚Ä¢ `TrafficBalance =                                                                                                                                                                                                            | sTos - dTos | `<br>‚Ä¢ `Intensity = TotBytes / (Dur + 1)`<br>‚û°Ô∏è Semua fitur ini digunakan sebagai input ke model ML. |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **9**          | **Menyiapkan Data Fitur & Target**              | - `X_full` = semua fitur numerik.<br>- `y_full` = kolom Label (0/1).<br>- Jika dataset terlalu besar, disampling hingga maksimal 8 juta baris agar muat di RAM.                                                                                                                                                                                                                                                                           |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **10**         | **Train-Test Split & Scaling**                  | - Memecah data: 70% train, 30% test dengan `train_test_split` (stratified).<br>- Normalisasi fitur dengan `StandardScaler` agar model lebih stabil dan cepat konvergen.                                                                                                                                                                                                                                                                   |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **11**         | **Training Model Stacking (passthrough=False)** | - Menjalankan ensemble model **StackingClassifier** berisi 3 base learner:<br>   üü¶ RandomForestClassifier<br>   üü© ExtraTreesClassifier<br>   üüß HistGradientBoostingClassifier<br>- Meta-classifier: LogisticRegression.<br>- Jika Stacking gagal (misal kehabisan RAM), fallback otomatis ke RandomForest.<br>- Semua berjalan single-thread (`n_jobs=1`) agar aman di CPU-only sistem.                                                |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **12**         | **Evaluasi Global Model**                       | - Menghitung prediksi probabilitas di data test (`p_test`).<br>- Menentukan **best threshold** secara otomatis dari ROC curve.<br>- Menghitung metrik performa: **Accuracy, Precision, Recall, F1, ROC-AUC**.<br>- Menampilkan hasil di terminal tanpa membuat plot (ROC/PR/CM dihapus).                                                                                                                                                  |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **13**         | **Full Inference di Semua Data**                | - Menggunakan scaler + model untuk menghitung `PredictedProb` dan `PredictedLabel` di seluruh dataset.<br>- Menyimpan hasil prediksi ke DataFrame utama `df`.                                                                                                                                                                                                                                                                             |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **14**         | **Loop per Sensor (Auto C&C Detection)**        | Untuk setiap `SensorId`: <br> - Menghitung statistik tiap node (`SrcAddr`, `DstAddr`):<br>   üîπ Jumlah koneksi masuk (`in_ct`) & keluar (`out_ct`)<br>   üîπ Rata-rata probabilitas malicious (`in_prob`, `out_prob`)<br>   üîπ Rasio masuk/keluar (`in_ratio`, `out_ratio`)<br>   üîπ Derajat total (`degree`)<br>- Mengklasifikasikan node menjadi **C&C** jika memenuhi:<br>   `avg_prob > 0.70`, `degree > 110`, dan `out_ratio > 0.70`. |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **15**         | **CNC Scoring**                                 | - Untuk node terdeteksi C&C, dihitung **cnc_score**:<br>  `cnc_score = avg_prob √ó (1 + in_ratio + out_ratio) √ó log(1 + degree)`<br>- Semakin tinggi skor, semakin kuat indikasi node sebagai command-and-control.                                                                                                                                                                                                                         |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **16**         | **Dynamic 3D Graph (Memory-Safe)**              | - Mengecek kapasitas RAM tersedia (`available_gb`).<br>- Menetapkan batas aman otomatis:<br>                                                                                                                                                                                                                                                                                                                                              | RAM         | MAX_NODES                                                                                            | MAX_EDGES | <br> | ------ | ------------ | ----------- | <br> | <4GB | 200 | 400 | <br> | <8GB | 300 | 600 | <br> | ‚â•8GB | 500 | 800 | <br>- Hanya menampilkan node C&C + tetangganya, dengan sampling untuk membatasi ukuran graf. |
| **17**         | **Membangun & Menyimpan 3D Graph**              | - Membuat **directed graph (DiGraph)** dengan `networkx`.<br>- Hitung posisi 3D dengan `nx.spring_layout(dim=3)` (iterasi dibatasi 60 agar cepat).<br>- Warna node:<br>  üî¥ C&C node = merah<br>  üîµ Normal node = biru<br>- Menggambar dengan **Plotly Scatter3D**, dan menyimpan sebagai HTML interaktif di folder output (`SensorX_3DGraphSafe_timestamp.html`).                                                                       |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **18**         | **Logging RAM & Garbage Collection per Sensor** | - Setelah tiap sensor selesai divisualisasi, dilakukan:<br>  `gc.collect()` untuk membebaskan memori.<br>  `log_ram()` untuk mencatat pemakaian RAM terkini.                                                                                                                                                                                                                                                                              |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
| **19**         | **Akhir Eksekusi**                              | - Setelah semua sensor selesai, script menampilkan: <br>‚ÄúDone. Memory-safe stacking + per-sensor 3D network visualization complete.‚Äù<br>- Menyimpan log pemakaian RAM ke file `.csv`.                                                                                                                                                                                                                                                     |             |                                                                                                      |           |      |        |              |             |      |      |     |     |      |      |     |     |      |      |     |     |                                                                                              |
